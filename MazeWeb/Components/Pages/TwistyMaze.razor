@page "/TwistyMaze"
@using labyrinth
@using MermaidJS.Blazor

<PageTitle>Twisty Maze Visualizer</PageTitle>

<h1>Enter your name</h1>
<input @bind="userName" />
<button @onclick="generateMaze">Generate Twisty Maze</button>

<MermaidDiagram Definition=@mazeBody />

@code
{
    string userName;
    IEnumerable<string> output = new List<string>();
    string mazeBody = "";

    void generateMaze()
    {
        @* Console.WriteLine("clicked, " +userName); *@
        MazeCell startLocation = MazeUtilities.twistyMazeFor(userName);
        @* Console.WriteLine(startLocation.Id ); *@
        var solver = new MazeSolver();
        output = solver.ExploreMaze(startLocation)
            .Select(node => 
            $"{node.From.Id}[\"{node.From}\"]--{node.Label}-->{node.To.Id}[\"{node.To}\"]");
        @* Console.WriteLine(output.Count() ); *@

        mazeBody = "graph TD\n";
        mazeBody += string.Join("\n", output);
    }
}